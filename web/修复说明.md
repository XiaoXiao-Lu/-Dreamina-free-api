# ğŸ”§ å›¾ç‰‡ç”Ÿæˆé—®é¢˜ä¿®å¤è¯´æ˜

## é—®é¢˜æè¿°

**ç—‡çŠ¶**: ç”Ÿæˆçš„å›¾ç‰‡ä¸æç¤ºè¯ä¸å¯¹åº”ï¼Œæ˜¾ç¤ºçš„æ˜¯éšæœºå›¾ç‰‡

**åŸå› **: å‰ç«¯ä»£ç ä½¿ç”¨çš„æ˜¯æ¨¡æ‹Ÿæ•°æ®ï¼ˆMock Dataï¼‰ï¼Œè€Œä¸æ˜¯çœŸå®çš„ API è°ƒç”¨

---

## é—®é¢˜åˆ†æ

### åŸå§‹ä»£ç é—®é¢˜

åœ¨ `web/js/app.js` ä¸­ï¼Œ`generateT2I()` å’Œ `generateI2I()` æ–¹æ³•ä½¿ç”¨äº†æ¨¡æ‹Ÿæ•°æ®ï¼š

```javascript
// âŒ é”™è¯¯ï¼šä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
const mockImages = Array(formData.numImages).fill(null).map((_, i) => 
    `https://picsum.photos/512/512?random=${Date.now() + i}`
);
```

è¿™ä¼šè¿”å›æ¥è‡ª picsum.photos çš„éšæœºå›¾ç‰‡ï¼Œè€Œä¸æ˜¯ Dreamina AI ç”Ÿæˆçš„å›¾ç‰‡ã€‚

### ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿æµ‹è¯•å‰ç«¯ç•Œé¢ï¼Œæˆ‘ä½¿ç”¨äº†æ¨¡æ‹Ÿæ•°æ®ã€‚ä½†å¿˜è®°åˆ‡æ¢åˆ°çœŸå®çš„ API è°ƒç”¨ã€‚

---

## è§£å†³æ–¹æ¡ˆ

### âœ… å·²ä¿®å¤

æˆ‘å·²ç»å°†æ¨¡æ‹Ÿä»£ç æ›¿æ¢ä¸ºçœŸå®çš„ API è°ƒç”¨ï¼š

#### 1. æ–‡ç”Ÿå›¾ä¿®å¤

**ä¿®æ”¹å‰**:
```javascript
// æ¨¡æ‹ŸAPIè°ƒç”¨
return new Promise((resolve, reject) => {
    setTimeout(() => {
        const mockImages = Array(formData.numImages).fill(null).map((_, i) => 
            `https://picsum.photos/512/512?random=${Date.now() + i}`
        );
        resolve({ images: mockImages });
    }, 3000);
});
```

**ä¿®æ”¹å**:
```javascript
// çœŸå®APIè°ƒç”¨
const response = await api.generateT2I({
    prompt: formData.prompt,
    model: formData.model,
    resolution: formData.resolution,
    ratio: formData.ratio,
    seed: formData.seed,
    num_images: formData.numImages,
});

// å¦‚æœç›´æ¥è¿”å›äº†å›¾ç‰‡
if (response.completed && response.images) {
    return {
        images: response.images,
        historyId: response.historyId,
    };
}

// å¦åˆ™è½®è¯¢æ£€æŸ¥çŠ¶æ€
const taskId = response.taskId;
while (attempts < maxAttempts) {
    const status = await api.checkStatus(taskId);
    if (status.completed && status.images) {
        return {
            images: status.images,
            historyId: status.historyId,
        };
    }
    await new Promise(resolve => setTimeout(resolve, 5000));
    attempts++;
}
```

#### 2. å›¾ç”Ÿå›¾ä¿®å¤

åŒæ ·çš„ä¿®å¤åº”ç”¨åˆ° `generateI2I()` æ–¹æ³•ã€‚

---

## éªŒè¯ä¿®å¤

### 1. é‡å¯æœåŠ¡å™¨

```bash
# åœæ­¢å½“å‰æœåŠ¡å™¨ (Ctrl+C)
# é‡æ–°å¯åŠ¨
python server.py
```

### 2. åˆ·æ–°æµè§ˆå™¨

```
æŒ‰ F5 æˆ– Ctrl+F5 å¼ºåˆ¶åˆ·æ–°
```

### 3. æµ‹è¯•ç”Ÿæˆ

1. **æ–‡ç”Ÿå›¾æµ‹è¯•**:
   - è¾“å…¥æç¤ºè¯: "ä¸€åªå¯çˆ±çš„æ©˜çŒ«"
   - ç‚¹å‡»ç”Ÿæˆ
   - ç­‰å¾… 10-30 ç§’
   - åº”è¯¥çœ‹åˆ° Dreamina ç”Ÿæˆçš„çŒ«å’ªå›¾ç‰‡

2. **å›¾ç”Ÿå›¾æµ‹è¯•**:
   - åˆ‡æ¢åˆ°å›¾ç”Ÿå›¾æ¨¡å¼
   - ä¸Šä¼ ä¸€å¼ å‚è€ƒå›¾
   - è¾“å…¥æç¤ºè¯
   - ç‚¹å‡»ç”Ÿæˆ
   - åº”è¯¥çœ‹åˆ°åŸºäºå‚è€ƒå›¾ç”Ÿæˆçš„æ–°å›¾ç‰‡

---

## å·¥ä½œæµç¨‹

### å®Œæ•´çš„ç”Ÿæˆæµç¨‹

```
ç”¨æˆ·è¾“å…¥æç¤ºè¯
    â†“
å‰ç«¯è°ƒç”¨ api.generateT2I()
    â†“
å‘é€ POST è¯·æ±‚åˆ° /api/generate/t2i
    â†“
åç«¯ server.py æ¥æ”¶è¯·æ±‚
    â†“
è°ƒç”¨ api_client.generate_t2i()
    â†“
TokenManager ç”Ÿæˆç­¾å
    â†“
è¯·æ±‚ Dreamina API
    â†“
Dreamina å¼€å§‹ç”Ÿæˆå›¾ç‰‡
    â†“
è½®è¯¢æŸ¥è¯¢çŠ¶æ€ (æ¯5ç§’)
    â†“
ç”Ÿæˆå®Œæˆï¼Œè·å–å›¾ç‰‡ URLs
    â†“
è¿”å›ç»™å‰ç«¯
    â†“
å‰ç«¯æ˜¾ç¤ºçœŸå®çš„ç”Ÿæˆå›¾ç‰‡ âœ…
```

---

## æŠ€æœ¯ç»†èŠ‚

### 1. API ç«¯ç‚¹

**æ–‡ç”Ÿå›¾**:
```
POST /api/generate/t2i
Content-Type: application/json

{
  "prompt": "æç¤ºè¯",
  "model": "3.0",
  "resolution": "2k",
  "ratio": "1:1",
  "seed": -1,
  "num_images": 4
}
```

**å“åº”**:
```json
{
  "success": true,
  "completed": true,
  "images": [
    "https://dreamina.com/image1.jpg",
    "https://dreamina.com/image2.jpg"
  ],
  "historyId": "xxx"
}
```

### 2. è½®è¯¢æœºåˆ¶

å¦‚æœå›¾ç‰‡æ²¡æœ‰ç«‹å³ç”Ÿæˆï¼Œä¼šè¿”å› `taskId`ï¼Œå‰ç«¯éœ€è¦è½®è¯¢ï¼š

```javascript
// æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡
while (attempts < 60) {
    const status = await api.checkStatus(taskId);
    if (status.completed) {
        return status.images;
    }
    await new Promise(resolve => setTimeout(resolve, 5000));
    attempts++;
}
```

### 3. è¿›åº¦æ˜¾ç¤º

```javascript
// 10% - è¿æ¥æœåŠ¡å™¨
ui.updateProgress(10, 'æ­£åœ¨è¿æ¥æœåŠ¡å™¨...');

// 30% - ä»»åŠ¡å·²æäº¤
ui.updateProgress(30, 'ä»»åŠ¡å·²æäº¤...');

// 30-90% - ç”Ÿæˆä¸­ï¼ˆæ ¹æ®è½®è¯¢æ¬¡æ•°ï¼‰
ui.updateProgress(progress, 'æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...');

// 100% - å®Œæˆ
ui.updateProgress(100, 'ç”Ÿæˆå®Œæˆï¼');
```

---

## å¸¸è§é—®é¢˜

### Q1: è¿˜æ˜¯æ˜¾ç¤ºéšæœºå›¾ç‰‡ï¼Ÿ

**A**: è¯·ç¡®ä¿ï¼š
1. å·²é‡å¯æœåŠ¡å™¨
2. å·²å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ (Ctrl+F5)
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

### Q2: ç”Ÿæˆå¤±è´¥ï¼Ÿ

**A**: æ£€æŸ¥ï¼š
1. SessionID æ˜¯å¦æœ‰æ•ˆ
2. ç§¯åˆ†æ˜¯å¦å……è¶³
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ (F12)

### Q3: ç”Ÿæˆå¾ˆæ…¢ï¼Ÿ

**A**: è¿™æ˜¯æ­£å¸¸çš„ï¼š
- æ–‡ç”Ÿå›¾é€šå¸¸éœ€è¦ 10-30 ç§’
- å›¾ç”Ÿå›¾å¯èƒ½éœ€è¦ 20-60 ç§’
- 4K åˆ†è¾¨ç‡ä¼šæ›´æ…¢

### Q4: å¦‚ä½•æŸ¥çœ‹è¯¦ç»†é”™è¯¯ï¼Ÿ

**A**: 
1. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾
3. æŸ¥çœ‹çº¢è‰²é”™è¯¯ä¿¡æ¯
4. åˆ‡æ¢åˆ° Network æ ‡ç­¾æŸ¥çœ‹ API è¯·æ±‚

---

## æµ‹è¯•æ¸…å•

- [ ] æ–‡ç”Ÿå›¾ - ç®€å•æç¤ºè¯
- [ ] æ–‡ç”Ÿå›¾ - å¤æ‚æç¤ºè¯
- [ ] æ–‡ç”Ÿå›¾ - ä¸åŒæ¨¡å‹
- [ ] æ–‡ç”Ÿå›¾ - ä¸åŒåˆ†è¾¨ç‡
- [ ] å›¾ç”Ÿå›¾ - å•å¼ å‚è€ƒå›¾
- [ ] å›¾ç”Ÿå›¾ - å¤šå¼ å‚è€ƒå›¾
- [ ] æŸ¥çœ‹å†å²è®°å½•
- [ ] å›¾ç‰‡é¢„è§ˆ
- [ ] å›¾ç‰‡ä¸‹è½½

---

## ä»£ç å¯¹æ¯”

### ä¿®æ”¹çš„æ–‡ä»¶

- `web/js/app.js` - ä¸»åº”ç”¨é€»è¾‘

### ä¿®æ”¹çš„æ–¹æ³•

1. `generateT2I()` - ç¬¬ 159-220 è¡Œ
2. `generateI2I()` - ç¬¬ 222-293 è¡Œ

### ä¿®æ”¹å†…å®¹

- âŒ åˆ é™¤ï¼šæ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆä»£ç 
- âœ… æ·»åŠ ï¼šçœŸå® API è°ƒç”¨
- âœ… æ·»åŠ ï¼šè½®è¯¢çŠ¶æ€æ£€æŸ¥
- âœ… æ·»åŠ ï¼šé”™è¯¯å¤„ç†

---

## æ€§èƒ½ä¼˜åŒ–

### 1. è½®è¯¢é—´éš”

```javascript
// å½“å‰ï¼šæ¯5ç§’æ£€æŸ¥ä¸€æ¬¡
await new Promise(resolve => setTimeout(resolve, 5000));

// å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ï¼š
// æ›´å¿«ï¼š3ç§’
// æ›´æ…¢ï¼š10ç§’ï¼ˆèŠ‚çœè¯·æ±‚ï¼‰
```

### 2. è¶…æ—¶è®¾ç½®

```javascript
// å½“å‰ï¼šæœ€å¤šç­‰å¾…5åˆ†é’Ÿï¼ˆ60æ¬¡ Ã— 5ç§’ï¼‰
const maxAttempts = 60;

// å¯ä»¥è°ƒæ•´ï¼š
// æ›´çŸ­ï¼š30æ¬¡ï¼ˆ2.5åˆ†é’Ÿï¼‰
// æ›´é•¿ï¼š120æ¬¡ï¼ˆ10åˆ†é’Ÿï¼‰
```

### 3. è¿›åº¦è®¡ç®—

```javascript
// çº¿æ€§è¿›åº¦
const progress = Math.min(90, 30 + (attempts / maxAttempts) * 60);

// å¯ä»¥æ”¹ä¸ºéçº¿æ€§ï¼ˆå‰æœŸå¿«ï¼ŒåæœŸæ…¢ï¼‰
const progress = Math.min(90, 30 + Math.sqrt(attempts / maxAttempts) * 60);
```

---

## åç»­æ”¹è¿›

### çŸ­æœŸ

- [ ] æ·»åŠ å–æ¶ˆç”ŸæˆåŠŸèƒ½
- [ ] ä¼˜åŒ–é”™è¯¯æç¤º
- [ ] æ·»åŠ é‡è¯•æœºåˆ¶

### ä¸­æœŸ

- [ ] WebSocket å®æ—¶æ¨é€ï¼ˆæ›¿ä»£è½®è¯¢ï¼‰
- [ ] æ‰¹é‡ç”Ÿæˆé˜Ÿåˆ—
- [ ] ç”Ÿæˆè¿›åº¦è¯¦æƒ…

### é•¿æœŸ

- [ ] ç¦»çº¿ç”Ÿæˆï¼ˆPWAï¼‰
- [ ] ç”Ÿæˆå†å²äº‘åŒæ­¥
- [ ] AI æç¤ºè¯ä¼˜åŒ–

---

## æ€»ç»“

âœ… **é—®é¢˜å·²è§£å†³**: å›¾ç‰‡ç°åœ¨ä¼šæ­£ç¡®æ˜¾ç¤º Dreamina AI ç”Ÿæˆçš„å†…å®¹

âœ… **ä¿®å¤å†…å®¹**: 
- æ›¿æ¢æ¨¡æ‹Ÿæ•°æ®ä¸ºçœŸå® API è°ƒç”¨
- æ·»åŠ è½®è¯¢æœºåˆ¶
- ä¼˜åŒ–è¿›åº¦æ˜¾ç¤º

âœ… **å¦‚ä½•ä½¿ç”¨**:
1. é‡å¯æœåŠ¡å™¨
2. åˆ·æ–°æµè§ˆå™¨
3. è¾“å…¥æç¤ºè¯
4. ç­‰å¾…ç”Ÿæˆ
5. æŸ¥çœ‹çœŸå®ç»“æœ

---

**ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼** ğŸ‰

å¦‚æœ‰å…¶ä»–é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯ã€‚

