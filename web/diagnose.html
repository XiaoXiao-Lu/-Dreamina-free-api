<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯Šæ–­å·¥å…· - Dreamina AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .section h2 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #333;
        }

        .result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #5568d3;
        }

        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” è¯Šæ–­å·¥å…·</h1>

        <div class="section">
            <h2>1. åŸºæœ¬ä¿¡æ¯</h2>
            <div id="basic-info"></div>
        </div>

        <div class="section">
            <h2>2. API é…ç½®</h2>
            <div id="api-config"></div>
        </div>

        <div class="section">
            <h2>3. æµ‹è¯•è´¦å· API</h2>
            <button onclick="testAccountsAPI()">æµ‹è¯• GET /api/accounts</button>
            <div id="accounts-result"></div>
        </div>

        <div class="section">
            <h2>4. æµ‹è¯• StorageManager</h2>
            <button onclick="testStorageManager()">æµ‹è¯• StorageManager</button>
            <div id="storage-result"></div>
        </div>

        <div class="section">
            <h2>5. JavaScript é”™è¯¯æ—¥å¿—</h2>
            <div id="error-log"></div>
        </div>
    </div>

    <script src="js/config.js?v=4"></script>
    <script src="js/api.js?v=4"></script>

    <script>
        // é”™è¯¯æ—¥å¿—
        const errors = [];
        window.onerror = function(msg, url, line, col, error) {
            errors.push({
                message: msg,
                url: url,
                line: line,
                col: col,
                error: error
            });
            updateErrorLog();
        };

        // æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
        function showBasicInfo() {
            const info = document.getElementById('basic-info');
            info.innerHTML = `
                <div class="result info">
                    <strong>User Agent:</strong> ${navigator.userAgent}<br>
                    <strong>å½“å‰ URL:</strong> ${window.location.href}<br>
                    <strong>å±å¹•å°ºå¯¸:</strong> ${window.innerWidth} x ${window.innerHeight}<br>
                    <strong>æ—¶é—´:</strong> ${new Date().toLocaleString()}
                </div>
            `;
        }

        // æ˜¾ç¤º API é…ç½®
        function showAPIConfig() {
            const config = document.getElementById('api-config');
            try {
                config.innerHTML = `
                    <div class="result success">
                        <strong>CONFIG å¯¹è±¡å­˜åœ¨:</strong> âœ…<br>
                        <strong>API Base URL:</strong> ${CONFIG.api.baseUrl}<br>
                        <strong>Storage Keys:</strong> ${JSON.stringify(CONFIG.storage, null, 2)}
                    </div>
                `;
            } catch (e) {
                config.innerHTML = `
                    <div class="result error">
                        <strong>é”™è¯¯:</strong> ${e.message}
                    </div>
                `;
            }
        }

        // æµ‹è¯•è´¦å· API
        async function testAccountsAPI() {
            const result = document.getElementById('accounts-result');
            result.innerHTML = '<div class="result info">æ­£åœ¨æµ‹è¯•...</div>';

            try {
                const response = await fetch(`${CONFIG.api.baseUrl}/accounts`);
                const data = await response.json();

                if (data.success) {
                    result.innerHTML = `
                        <div class="result success">
                            <strong>âœ… API è°ƒç”¨æˆåŠŸ</strong><br>
                            <strong>è´¦å·æ•°é‡:</strong> ${data.accounts.length}<br>
                            <strong>è´¦å·åˆ—è¡¨:</strong>
                            <pre>${JSON.stringify(data.accounts, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    result.innerHTML = `
                        <div class="result error">
                            <strong>âŒ API è¿”å›å¤±è´¥</strong><br>
                            <strong>æ¶ˆæ¯:</strong> ${data.message}
                        </div>
                    `;
                }
            } catch (e) {
                result.innerHTML = `
                    <div class="result error">
                        <strong>âŒ API è°ƒç”¨å¤±è´¥</strong><br>
                        <strong>é”™è¯¯:</strong> ${e.message}<br>
                        <strong>Stack:</strong> ${e.stack}
                    </div>
                `;
            }
        }

        // æµ‹è¯• StorageManager
        async function testStorageManager() {
            const result = document.getElementById('storage-result');
            result.innerHTML = '<div class="result info">æ­£åœ¨æµ‹è¯•...</div>';

            try {
                // æ£€æŸ¥ storage å¯¹è±¡æ˜¯å¦å­˜åœ¨
                if (typeof storage === 'undefined') {
                    result.innerHTML = `
                        <div class="result error">
                            <strong>âŒ storage å¯¹è±¡ä¸å­˜åœ¨</strong><br>
                            è¿™å¯èƒ½æ˜¯å› ä¸º api.js æ²¡æœ‰æ­£ç¡®åŠ è½½æˆ–åˆå§‹åŒ–
                        </div>
                    `;
                    return;
                }

                // æµ‹è¯• getAccounts
                const accounts = await storage.getAccounts();
                
                result.innerHTML = `
                    <div class="result success">
                        <strong>âœ… StorageManager å·¥ä½œæ­£å¸¸</strong><br>
                        <strong>è·å–åˆ°çš„è´¦å·æ•°é‡:</strong> ${accounts.length}<br>
                        <strong>è´¦å·åˆ—è¡¨:</strong>
                        <pre>${JSON.stringify(accounts, null, 2)}</pre>
                    </div>
                `;
            } catch (e) {
                result.innerHTML = `
                    <div class="result error">
                        <strong>âŒ StorageManager æµ‹è¯•å¤±è´¥</strong><br>
                        <strong>é”™è¯¯:</strong> ${e.message}<br>
                        <strong>Stack:</strong> ${e.stack}
                    </div>
                `;
            }
        }

        // æ›´æ–°é”™è¯¯æ—¥å¿—
        function updateErrorLog() {
            const log = document.getElementById('error-log');
            if (errors.length === 0) {
                log.innerHTML = '<div class="result success">âœ… æ²¡æœ‰ JavaScript é”™è¯¯</div>';
            } else {
                log.innerHTML = errors.map(err => `
                    <div class="result error">
                        <strong>é”™è¯¯:</strong> ${err.message}<br>
                        <strong>æ–‡ä»¶:</strong> ${err.url}<br>
                        <strong>è¡Œå·:</strong> ${err.line}:${err.col}
                    </div>
                `).join('');
            }
        }

        // åˆå§‹åŒ–
        window.onload = function() {
            showBasicInfo();
            showAPIConfig();
            updateErrorLog();

            // è‡ªåŠ¨æµ‹è¯•
            setTimeout(() => {
                testAccountsAPI();
                testStorageManager();
            }, 500);
        };
    </script>
</body>
</html>

