# 手势操作说明

## 原图查看器 - 手势操作

### 📱 手机端手势

#### 1. 打开原图
- 点击历史记录中的图片缩略图
- 自动打开全屏原图查看器

#### 2. 关闭原图 ⭐ 新功能
**向下滑动关闭**
- 在原图上向下滑动 (滑动距离 > 100px)
- 滑动时图片会跟随手指移动
- 背景透明度和图片缩放会实时变化
- 松手时:
  - 滑动距离 > 100px: 自动关闭查看器
  - 滑动距离 < 100px: 弹回原位

**其他关闭方式**
- 点击右上角 ✕ 按钮
- 点击图片外的黑色背景区域

#### 3. 切换图片 (多张图片时)
**左右滑动切换**
- 向左滑动: 下一张
- 向右滑动: 上一张
- 滑动距离需 > 50px

**点击箭头**
- 点击左侧箭头: 上一张
- 点击右侧箭头: 下一张

#### 4. 缩放图片
**双指缩放**
- 两指捏合: 缩小
- 两指分开: 放大
- 缩放范围: 0.5x - 5x

**双击缩放**
- 双击图片: 在 1x 和 2x 之间切换

**缩放按钮**
- 点击 + 按钮: 放大
- 点击 - 按钮: 缩小
- 点击重置按钮: 恢复 1x

#### 5. 拖动图片
- 当图片缩放 > 1x 时
- 单指拖动可以移动图片位置

#### 6. 下载图片
- 点击底部"下载"按钮
- 自动下载原图到本地

---

### 🖥️ 电脑端操作

#### 1. 打开/关闭
- 点击图片打开
- 按 ESC 键关闭
- 点击 ✕ 按钮关闭
- 点击背景关闭

#### 2. 切换图片
- 按 ← 键: 上一张
- 按 → 键: 下一张
- 点击左右箭头

#### 3. 缩放
- 鼠标滚轮: 缩放
- 双击图片: 在 1x 和 2x 之间切换
- 点击缩放按钮

#### 4. 拖动
- 当图片缩放 > 1x 时
- 鼠标拖动可以移动图片

---

## 手势优先级

### 缩放状态下 (scale > 1)
- ✅ 单指拖动: 移动图片
- ✅ 双指缩放: 继续缩放
- ❌ 滑动切换: 禁用
- ❌ 滑动关闭: 禁用

### 正常状态下 (scale = 1)
- ✅ 左右滑动: 切换图片 (多张时)
- ✅ 向下滑动: 关闭查看器
- ✅ 双击: 放大到 2x
- ✅ 双指缩放: 缩放图片

---

## 视觉反馈

### 向下滑动关闭
1. **滑动中**
   - 图片跟随手指向下移动
   - 背景透明度逐渐降低 (1.0 → 0.3)
   - 图片缩放逐渐变小 (1.0 → 0.8)
   - 最大滑动距离: 300px

2. **松手判断**
   - 滑动 > 100px: 关闭查看器
   - 滑动 < 100px: 0.3s 动画弹回原位

### 左右滑动切换
- 滑动 > 50px: 触发切换
- 平滑过渡到下一张/上一张

### 缩放提示
- 原图加载完成后显示 3 秒
- 提示可用的缩放操作

---

## 技术实现

### 滑动检测逻辑
```javascript
// 判断滑动方向
if (Math.abs(deltaX) > Math.abs(deltaY)) {
    // 水平滑动 - 切换图片
} else {
    // 垂直滑动 - 关闭查看器
}
```

### 实时视觉反馈
```javascript
const progress = Math.min(deltaY / 300, 1);
const opacity = 1 - progress * 0.7;  // 透明度
const scale = 1 - progress * 0.2;    // 缩放

viewer.style.backgroundColor = `rgba(0, 0, 0, ${opacity})`;
image.style.transform = `translateY(${deltaY}px) scale(${scale})`;
```

### 恢复动画
```javascript
// 滑动距离不够时,平滑恢复
image.style.transition = 'transform 0.3s ease';
image.style.transform = '';
```

---

## 兼容性

- ✅ iOS Safari
- ✅ Android Chrome
- ✅ 微信内置浏览器
- ✅ 各种移动端浏览器
- ✅ 桌面浏览器 (鼠标操作)

---

## 更新日志

### v1.1 - 2025-01-XX
- ✨ 新增: 向下滑动关闭原图功能
- ✨ 新增: 滑动时实时视觉反馈
- 🎨 优化: 滑动手势检测逻辑
- 🐛 修复: 缩放状态下误触发滑动的问题

