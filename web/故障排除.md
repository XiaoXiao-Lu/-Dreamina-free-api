# 🔧 故障排除指南

## 问题：start.bat 启动闪退

### 快速解决方案

#### 方案 1：使用简化版启动脚本

```bash
双击运行: start_simple.bat
```

这个脚本会显示更多信息，不会立即关闭。

#### 方案 2：使用环境检查工具

```bash
双击运行: check_env.bat
```

这会检查你的环境配置，找出问题所在。

#### 方案 3：手动启动

1. 打开命令提示符（CMD）
2. 进入 web 目录：
   ```bash
   cd c:\Users\Kinnon\Desktop\Comfyui_Free_Dreamina-main\web
   ```
3. 运行：
   ```bash
   python server.py
   ```

---

## 常见问题及解决方法

### 1. Python 未安装或未找到

**症状**：
- 提示 "python 不是内部或外部命令"
- 脚本闪退

**解决方法**：

1. **检查 Python 是否安装**
   ```bash
   # 打开 CMD，输入：
   python --version
   ```

2. **如果未安装**
   - 下载：https://www.python.org/downloads/
   - 安装时**务必勾选** "Add Python to PATH"
   - 重启电脑

3. **如果已安装但找不到**
   - 手动添加到 PATH 环境变量
   - 或使用完整路径：
     ```bash
     C:\Python39\python.exe server.py
     ```

---

### 2. 依赖安装失败

**症状**：
- 提示 "No module named 'flask'"
- pip 安装失败

**解决方法**：

1. **升级 pip**
   ```bash
   python -m pip install --upgrade pip
   ```

2. **手动安装依赖**
   ```bash
   pip install flask
   pip install flask-cors
   ```

3. **使用国内镜像**（如果网络慢）
   ```bash
   pip install -i https://pypi.tuna.tsinghua.edu.cn/simple flask flask-cors
   ```

4. **检查是否安装成功**
   ```bash
   pip list | findstr flask
   ```

---

### 3. 找不到 server.py

**症状**：
- 提示 "找不到 server.py"
- 脚本闪退

**解决方法**：

1. **确认当前目录**
   ```bash
   # 在 CMD 中查看当前目录
   cd
   
   # 应该显示：
   # c:\Users\Kinnon\Desktop\Comfyui_Free_Dreamina-main\web
   ```

2. **如果不在 web 目录**
   ```bash
   cd c:\Users\Kinnon\Desktop\Comfyui_Free_Dreamina-main\web
   ```

3. **检查文件是否存在**
   ```bash
   dir server.py
   ```

---

### 4. 端口被占用

**症状**：
- 提示 "Address already in use"
- 端口 5000 被占用

**解决方法**：

1. **查找占用端口的进程**
   ```bash
   netstat -ano | findstr :5000
   ```

2. **结束进程**
   ```bash
   # 假设 PID 是 1234
   taskkill /PID 1234 /F
   ```

3. **或修改端口**
   - 编辑 `server.py`
   - 将 `port=5000` 改为 `port=5001`

---

### 5. 配置文件问题

**症状**：
- 提示找不到配置文件
- 无法读取配置

**解决方法**：

1. **检查配置文件**
   ```bash
   # 查看上级目录
   dir ..\config.json
   ```

2. **手动创建配置文件**
   ```bash
   copy ..\config.json.template ..\config.json
   ```

3. **编辑配置文件**
   - 用记事本打开 `config.json`
   - 添加你的 SessionID

---

### 6. 权限问题

**症状**：
- 提示 "拒绝访问"
- 无法创建文件

**解决方法**：

1. **以管理员身份运行**
   - 右键点击 `start.bat`
   - 选择 "以管理员身份运行"

2. **检查文件夹权限**
   - 右键点击文件夹
   - 属性 → 安全 → 编辑
   - 确保有完全控制权限

---

### 7. 防火墙阻止

**症状**：
- 服务器启动成功
- 但无法访问网页

**解决方法**：

1. **允许 Python 通过防火墙**
   - 控制面板 → Windows 防火墙
   - 允许应用通过防火墙
   - 找到 Python，勾选

2. **临时关闭防火墙测试**
   - 如果关闭后可以访问
   - 说明是防火墙问题

---

### 8. 中文路径问题

**症状**：
- 路径包含中文
- 出现编码错误

**解决方法**：

1. **避免中文路径**
   - 将项目移到英文路径
   - 例如：`C:\Projects\Dreamina\`

2. **或修改编码**
   - 在脚本开头添加：
     ```batch
     chcp 65001
     ```

---

## 调试步骤

### 步骤 1：运行环境检查

```bash
双击运行: check_env.bat
```

查看哪些检查失败，根据提示解决。

### 步骤 2：使用简化版启动

```bash
双击运行: start_simple.bat
```

这个版本会显示详细信息。

### 步骤 3：手动启动

打开 CMD，逐步执行：

```bash
# 1. 进入目录
cd c:\Users\Kinnon\Desktop\Comfyui_Free_Dreamina-main\web

# 2. 检查 Python
python --version

# 3. 安装依赖
pip install flask flask-cors

# 4. 启动服务器
python server.py
```

观察每一步的输出，找出问题。

---

## 完整的手动启动流程

如果脚本始终有问题，可以完全手动操作：

### 1. 打开命令提示符

- 按 `Win + R`
- 输入 `cmd`
- 回车

### 2. 进入项目目录

```bash
cd c:\Users\Kinnon\Desktop\Comfyui_Free_Dreamina-main\web
```

### 3. 检查 Python

```bash
python --version
```

应该显示类似：`Python 3.9.0`

### 4. 安装依赖

```bash
pip install flask flask-cors
```

等待安装完成。

### 5. 创建配置文件（如果不存在）

```bash
copy ..\config.json.template ..\config.json
```

### 6. 编辑配置文件

```bash
notepad ..\config.json
```

添加你的 SessionID，保存。

### 7. 启动服务器

```bash
python server.py
```

### 8. 打开浏览器

访问：http://localhost:5000

---

## 获取详细错误信息

如果还是有问题，请提供以下信息：

### 1. 运行环境检查

```bash
check_env.bat
```

截图或复制输出。

### 2. 手动启动的错误信息

```bash
cd web
python server.py
```

复制完整的错误信息。

### 3. Python 版本

```bash
python --version
pip --version
```

### 4. 已安装的包

```bash
pip list
```

---

## 常用命令参考

```bash
# 查看 Python 版本
python --version

# 查看 pip 版本
pip --version

# 安装包
pip install 包名

# 查看已安装的包
pip list

# 查看特定包
pip show flask

# 升级 pip
python -m pip install --upgrade pip

# 查看当前目录
cd

# 列出文件
dir

# 进入目录
cd 目录名

# 返回上级目录
cd ..

# 查看端口占用
netstat -ano | findstr :5000

# 结束进程
taskkill /PID 进程号 /F
```

---

## 联系支持

如果以上方法都无法解决问题，请提供：

1. `check_env.bat` 的输出
2. 手动运行 `python server.py` 的错误信息
3. Python 版本信息
4. 操作系统版本

这样可以更快地帮你解决问题。

---

## 快速参考

| 问题 | 解决方案 |
|-----|---------|
| Python 未找到 | 安装 Python 并添加到 PATH |
| 依赖安装失败 | 使用国内镜像源 |
| 找不到文件 | 确认在 web 目录下 |
| 端口被占用 | 结束占用进程或换端口 |
| 权限不足 | 以管理员身份运行 |
| 防火墙阻止 | 允许 Python 通过防火墙 |

---

**祝你顺利启动！** 🚀

