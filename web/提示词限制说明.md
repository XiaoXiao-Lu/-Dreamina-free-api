# 📝 提示词字数限制说明

## 修改内容

已将提示词字数限制从 **1000** 字符增加到 **1600** 字符。

---

## 修改的文件

### 1. web/index.html
**修改位置**: 第 85-101 行

**修改内容**:
```html
<!-- 修改前 -->
<textarea id="prompt" ...>一只可爱的小猫咪</textarea>
<div class="char-count">
    <span id="charCount">0</span>/1000
</div>

<!-- 修改后 -->
<textarea id="prompt" maxlength="1600" ...>一只可爱的小猫咪</textarea>
<div class="char-count">
    <span id="charCount">0</span>/1600
</div>
```

**说明**:
- 添加了 `maxlength="1600"` 属性，浏览器会自动阻止输入超过 1600 个字符
- 更新显示文本为 `/1600`

---

### 2. web/js/config.js
**修改位置**: 第 110-115 行

**修改内容**:
```javascript
// 修改前
limits: {
    maxPromptLength: 1000,
    maxReferenceImages: 6,
    maxHistoryItems: 50
}

// 修改后
limits: {
    maxPromptLength: 1600,
    maxReferenceImages: 6,
    maxHistoryItems: 50
}
```

**说明**:
- 更新配置常量，用于前端验证和字符计数颜色提示

---

### 3. web/server.py
**修改位置**: 
- 文生图: 第 183-199 行
- 图生图: 第 300-312 行

**修改内容**:
```python
# 添加长度验证
if len(prompt) > 1600:
    return jsonify({
        'success': False,
        'message': '提示词长度不能超过1600个字符'
    }), 400
```

**说明**:
- 在服务器端添加验证，防止绕过前端限制
- 文生图和图生图都添加了相同的验证

---

## 功能说明

### 前端限制

1. **HTML 原生限制**
   - `maxlength="1600"` 属性
   - 浏览器自动阻止输入超过限制的字符
   - 用户无法输入超过 1600 个字符

2. **实时字符计数**
   - 显示当前字符数 / 1600
   - 超过限制时字符计数变红色（虽然有 maxlength 限制，这个功能作为备用）

3. **视觉反馈**
   ```javascript
   if (length > CONFIG.limits.maxPromptLength) {
       this.charCount.style.color = 'var(--danger-color)';  // 红色
   } else {
       this.charCount.style.color = 'var(--text-muted)';    // 灰色
   }
   ```

### 后端验证

1. **双重保护**
   - 即使前端被绕过，后端也会验证
   - 返回 400 错误和友好的错误提示

2. **错误提示**
   ```json
   {
       "success": false,
       "message": "提示词长度不能超过1600个字符"
   }
   ```

---

## 使用示例

### 正常使用
```
用户输入: "一只可爱的橘猫..." (100 字符)
显示: 100/1600 (灰色)
结果: ✅ 可以提交
```

### 接近限制
```
用户输入: "..." (1500 字符)
显示: 1500/1600 (灰色)
结果: ✅ 可以提交
```

### 达到限制
```
用户输入: "..." (1600 字符)
显示: 1600/1600 (灰色)
结果: ✅ 可以提交，但无法继续输入
```

### 超过限制（理论上不会发生）
```
如果绕过前端限制:
服务器返回: ❌ "提示词长度不能超过1600个字符"
```

---

## 技术细节

### 字符计数逻辑

**文件**: `web/js/ui.js` (第 122-131 行)

```javascript
updateCharCount() {
    const length = this.promptInput.value.length;
    this.charCount.textContent = length;
    
    if (length > CONFIG.limits.maxPromptLength) {
        this.charCount.style.color = 'var(--danger-color)';
    } else {
        this.charCount.style.color = 'var(--text-muted)';
    }
}
```

**触发时机**:
- 用户每次输入时 (`input` 事件)
- 实时更新字符计数

---

## 为什么是 1600？

### Dreamina API 限制
- Dreamina 官方 API 支持的最大提示词长度
- 与官网保持一致

### 用户体验
- 足够长，可以写详细的描述
- 不会太长导致生成效果不佳
- 符合大多数用户的使用习惯

---

## 测试验证

### 测试用例

1. **短提示词** ✅
   ```
   输入: "一只猫"
   预期: 正常生成
   ```

2. **中等长度** ✅
   ```
   输入: 500 字符的描述
   预期: 正常生成
   ```

3. **接近限制** ✅
   ```
   输入: 1590 字符
   预期: 正常生成
   ```

4. **达到限制** ✅
   ```
   输入: 1600 字符
   预期: 正常生成，无法继续输入
   ```

5. **尝试超过限制** ✅
   ```
   输入: 尝试输入第 1601 个字符
   预期: 浏览器阻止输入
   ```

---

## 兼容性

### 浏览器支持

| 浏览器 | maxlength 支持 | 字符计数 |
|--------|---------------|---------|
| Chrome | ✅ | ✅ |
| Firefox | ✅ | ✅ |
| Safari | ✅ | ✅ |
| Edge | ✅ | ✅ |
| 移动浏览器 | ✅ | ✅ |

**说明**: `maxlength` 是 HTML5 标准属性，所有现代浏览器都支持。

---

## 常见问题

### Q1: 为什么输入不了更多字符？

**A**: 提示词限制为 1600 个字符，这是 Dreamina API 的限制。达到限制后浏览器会自动阻止继续输入。

### Q2: 如何查看当前字符数？

**A**: 提示词输入框下方会实时显示当前字符数，格式为 "当前字数/1600"。

### Q3: 中文和英文字符计数一样吗？

**A**: 是的，每个字符（无论中文、英文、标点）都计为 1 个字符。

### Q4: 可以粘贴超过 1600 字符的文本吗？

**A**: 可以粘贴，但浏览器会自动截断到 1600 个字符。

### Q5: 如果我需要更长的提示词怎么办？

**A**: 建议：
- 精简描述，去掉不必要的词语
- 使用更精确的关键词
- 分多次生成，每次使用不同的提示词

---

## 修改总结

| 项目 | 修改前 | 修改后 |
|------|--------|--------|
| 最大长度 | 1000 字符 | 1600 字符 |
| HTML 限制 | 无 | maxlength="1600" |
| 前端验证 | ✅ | ✅ |
| 后端验证 | ❌ | ✅ |
| 字符计数显示 | /1000 | /1600 |
| 错误提示 | 无 | "提示词长度不能超过1600个字符" |

---

## 相关文件

- `web/index.html` - HTML 结构和 maxlength 属性
- `web/js/config.js` - 配置常量
- `web/js/ui.js` - 字符计数逻辑
- `web/server.py` - 服务器端验证

---

**✅ 修改完成！提示词字数限制已更新为 1600 字符。**

