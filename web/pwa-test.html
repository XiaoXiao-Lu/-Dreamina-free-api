<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWAåŠŸèƒ½æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        h1 {
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .test-section h2 {
            margin-bottom: 1rem;
            font-size: 1.25rem;
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
        }
        
        .status-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .status-icon.success {
            background: #10b981;
        }
        
        .status-icon.error {
            background: #ef4444;
        }
        
        .status-icon.warning {
            background: #f59e0b;
        }
        
        button {
            background: white;
            color: #667eea;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            margin-right: 0.5rem;
            margin-top: 0.5rem;
        }
        
        button:hover {
            transform: scale(1.05);
        }
        
        .log {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: monospace;
            font-size: 0.875rem;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .log-entry {
            margin-bottom: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” PWAåŠŸèƒ½æµ‹è¯•</h1>
        
        <!-- Service WorkerçŠ¶æ€ -->
        <div class="test-section">
            <h2>ğŸ“¡ Service Worker</h2>
            <div id="sw-status"></div>
            <button onclick="registerSW()">æ³¨å†ŒService Worker</button>
            <button onclick="unregisterSW()">æ³¨é”€Service Worker</button>
            <button onclick="updateSW()">æ£€æŸ¥æ›´æ–°</button>
        </div>
        
        <!-- ç¼“å­˜çŠ¶æ€ -->
        <div class="test-section">
            <h2>ğŸ’¾ ç¼“å­˜çŠ¶æ€</h2>
            <div id="cache-status"></div>
            <button onclick="checkCache()">æ£€æŸ¥ç¼“å­˜</button>
            <button onclick="clearCache()">æ¸…é™¤ç¼“å­˜</button>
        </div>
        
        <!-- PWAå®‰è£…çŠ¶æ€ -->
        <div class="test-section">
            <h2>ğŸ“± PWAå®‰è£…</h2>
            <div id="pwa-status"></div>
            <button onclick="checkPWA()">æ£€æŸ¥PWAçŠ¶æ€</button>
        </div>
        
        <!-- ç½‘ç»œçŠ¶æ€ -->
        <div class="test-section">
            <h2>ğŸ“¶ ç½‘ç»œçŠ¶æ€</h2>
            <div id="network-status"></div>
        </div>
        
        <!-- æ—¥å¿— -->
        <div class="test-section">
            <h2>ğŸ“‹ æ—¥å¿—</h2>
            <div id="log" class="log"></div>
            <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        </div>
    </div>
    
    <script>
        const log = (message, type = 'info') => {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            const time = new Date().toLocaleTimeString();
            entry.textContent = `[${time}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        };
        
        const clearLog = () => {
            document.getElementById('log').innerHTML = '';
        };
        
        const showStatus = (elementId, items) => {
            const div = document.getElementById(elementId);
            div.innerHTML = items.map(item => `
                <div class="status">
                    <div class="status-icon ${item.status}">${item.status === 'success' ? 'âœ“' : item.status === 'error' ? 'âœ—' : '!'}</div>
                    <div>${item.text}</div>
                </div>
            `).join('');
        };
        
        // Service Workeræ£€æŸ¥
        const checkSW = async () => {
            const items = [];
            
            if ('serviceWorker' in navigator) {
                items.push({ status: 'success', text: 'Service Worker APIæ”¯æŒ' });
                
                const registration = await navigator.serviceWorker.getRegistration();
                if (registration) {
                    items.push({ status: 'success', text: `å·²æ³¨å†Œ: ${registration.scope}` });
                    
                    if (registration.active) {
                        items.push({ status: 'success', text: 'çŠ¶æ€: æ¿€æ´»' });
                    } else if (registration.installing) {
                        items.push({ status: 'warning', text: 'çŠ¶æ€: å®‰è£…ä¸­' });
                    } else if (registration.waiting) {
                        items.push({ status: 'warning', text: 'çŠ¶æ€: ç­‰å¾…ä¸­' });
                    }
                } else {
                    items.push({ status: 'warning', text: 'æœªæ³¨å†ŒService Worker' });
                }
            } else {
                items.push({ status: 'error', text: 'Service Worker APIä¸æ”¯æŒ' });
            }
            
            showStatus('sw-status', items);
        };
        
        const registerSW = async () => {
            try {
                const registration = await navigator.serviceWorker.register('/sw.js');
                log('âœ… Service Workeræ³¨å†ŒæˆåŠŸ');
                await checkSW();
            } catch (error) {
                log('âŒ Service Workeræ³¨å†Œå¤±è´¥: ' + error.message);
            }
        };
        
        const unregisterSW = async () => {
            const registration = await navigator.serviceWorker.getRegistration();
            if (registration) {
                await registration.unregister();
                log('âœ… Service Workerå·²æ³¨é”€');
                await checkSW();
            }
        };
        
        const updateSW = async () => {
            const registration = await navigator.serviceWorker.getRegistration();
            if (registration) {
                await registration.update();
                log('ğŸ”„ æ£€æŸ¥Service Workeræ›´æ–°');
                await checkSW();
            }
        };
        
        // ç¼“å­˜æ£€æŸ¥
        const checkCache = async () => {
            const items = [];
            
            if ('caches' in window) {
                items.push({ status: 'success', text: 'Cache APIæ”¯æŒ' });
                
                const cacheNames = await caches.keys();
                items.push({ status: 'success', text: `ç¼“å­˜æ•°é‡: ${cacheNames.length}` });
                
                for (const name of cacheNames) {
                    const cache = await caches.open(name);
                    const keys = await cache.keys();
                    items.push({ status: 'success', text: `${name}: ${keys.length}ä¸ªèµ„æº` });
                }
            } else {
                items.push({ status: 'error', text: 'Cache APIä¸æ”¯æŒ' });
            }
            
            showStatus('cache-status', items);
        };
        
        const clearCache = async () => {
            const cacheNames = await caches.keys();
            for (const name of cacheNames) {
                await caches.delete(name);
            }
            log('âœ… ç¼“å­˜å·²æ¸…é™¤');
            await checkCache();
        };
        
        // PWAæ£€æŸ¥
        const checkPWA = () => {
            const items = [];
            
            // æ£€æŸ¥manifest
            const manifest = document.querySelector('link[rel="manifest"]');
            if (manifest) {
                items.push({ status: 'success', text: 'Manifestå·²é…ç½®' });
            } else {
                items.push({ status: 'error', text: 'Manifestæœªé…ç½®' });
            }
            
            // æ£€æŸ¥æ˜¯å¦åœ¨ç‹¬ç«‹æ¨¡å¼è¿è¡Œ
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches || 
                                window.navigator.standalone === true;
            if (isStandalone) {
                items.push({ status: 'success', text: 'è¿è¡Œæ¨¡å¼: PWAç‹¬ç«‹æ¨¡å¼' });
            } else {
                items.push({ status: 'warning', text: 'è¿è¡Œæ¨¡å¼: æµè§ˆå™¨æ¨¡å¼' });
            }
            
            // æ£€æŸ¥å¹³å°
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            if (isIOS) {
                items.push({ status: 'success', text: 'å¹³å°: iOS' });
            } else if (isAndroid) {
                items.push({ status: 'success', text: 'å¹³å°: Android' });
            } else {
                items.push({ status: 'success', text: 'å¹³å°: Desktop' });
            }
            
            showStatus('pwa-status', items);
        };
        
        // ç½‘ç»œçŠ¶æ€
        const checkNetwork = () => {
            const items = [];
            
            if (navigator.onLine) {
                items.push({ status: 'success', text: 'ç½‘ç»œçŠ¶æ€: åœ¨çº¿' });
            } else {
                items.push({ status: 'error', text: 'ç½‘ç»œçŠ¶æ€: ç¦»çº¿' });
            }
            
            if ('connection' in navigator) {
                const conn = navigator.connection;
                items.push({ status: 'success', text: `è¿æ¥ç±»å‹: ${conn.effectiveType || 'æœªçŸ¥'}` });
            }
            
            showStatus('network-status', items);
        };
        
        // åˆå§‹åŒ–
        window.addEventListener('load', async () => {
            log('ğŸš€ PWAæµ‹è¯•å·¥å…·å·²åŠ è½½');
            await checkSW();
            await checkCache();
            checkPWA();
            checkNetwork();
        });
        
        // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
        window.addEventListener('online', () => {
            log('ğŸ“¶ ç½‘ç»œå·²è¿æ¥');
            checkNetwork();
        });
        
        window.addEventListener('offline', () => {
            log('ğŸ“µ ç½‘ç»œå·²æ–­å¼€');
            checkNetwork();
        });
    </script>
</body>
</html>

