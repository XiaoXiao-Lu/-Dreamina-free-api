# 新生成照片标记功能

## 📸 功能说明

新生成的照片卡片会用特别的颜色和标记来突出显示,让您一眼就能看出哪些是刚刚生成的照片。当您打开查看原图后,标记会自动消失,恢复正常颜色。

## ✨ 视觉效果

### 新生成的卡片
- 🎨 **渐变背景**: 紫蓝色渐变背景 (比普通卡片更亮眼)
- 🌟 **发光边框**: 紫色发光边框,带有呼吸动画
- ⭐ **"新"徽章**: 右上角显示星星图标 + "新" 字样
- 💫 **动画效果**: 
  - 卡片边框呼吸动画 (2秒循环)
  - 徽章上下浮动动画 (1秒循环)
  - 星星图标旋转动画 (3秒循环)

### 查看后的卡片
- 恢复普通的灰色背景
- 移除发光边框
- 移除"新"徽章
- 移除所有动画效果

## 🎯 使用流程

1. **生成图片**
   - 点击"生成"按钮
   - 等待图片生成完成
   - 新生成的照片会自动添加到历史记录顶部

2. **识别新照片**
   - 新照片卡片有紫蓝色渐变背景
   - 右上角有"⭐ 新"徽章
   - 边框有呼吸动画效果

3. **查看照片**
   - 点击任意一张新照片的缩略图
   - 打开全屏原图查看器
   - 系统自动标记为已查看

4. **标记消失**
   - 关闭原图查看器
   - 卡片自动恢复正常颜色
   - "新"徽章自动消失

## 🔧 技术实现

### 前端实现

#### 1. 数据标记 (api.js)
```javascript
// 添加历史记录时自动添加 isNew 标记
async addHistory(item) {
    item.isNew = true;  // 标记为新生成
    // ... 保存到服务器
}

// 标记为已查看
async markHistoryAsViewed(itemId) {
    await fetch(`${CONFIG.api.baseUrl}/history/${itemId}/viewed`, {
        method: 'POST'
    });
}
```

#### 2. UI 渲染 (ui.js)
```javascript
// 渲染时添加特殊样式类
<div class="history-item ${item.isNew ? 'history-item-new' : ''}">
    ${item.isNew ? '<div class="new-badge"><i class="fas fa-star"></i> 新</div>' : ''}
</div>

// 点击查看时标记为已查看
showHistoryImage(historyId, imageIndex) {
    // ... 显示图片
    if (historyItem.isNew) {
        this.markHistoryItemAsViewed(historyId);
    }
}
```

#### 3. 样式定义 (style.css)
```css
/* 新生成的卡片 */
.history-item-new {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
    border: 2px solid rgba(102, 126, 234, 0.5);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    animation: newItemPulse 2s ease-in-out infinite;
}

/* 新标记徽章 */
.new-badge {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    animation: badgeBounce 1s ease-in-out infinite;
}
```

### 后端实现 (server.py)

#### 1. 保存历史记录
```python
@app.route('/api/history', methods=['POST'])
def add_history():
    # 接收包含 isNew: true 的数据
    data = request.json
    # 保存到 history.json
    save_history(history_records)
```

#### 2. 标记为已查看
```python
@app.route('/api/history/<history_id>/viewed', methods=['POST'])
def mark_history_viewed(history_id):
    # 找到对应记录并移除 isNew 标记
    for record in history_records:
        if record['id'] == history_id:
            if 'isNew' in record:
                del record['isNew']
    # 保存到文件
    save_history(history_records)
```

## 📊 数据结构

### 历史记录数据
```json
{
  "id": "1759542869593",
  "timestamp": "2025-10-04T09:54:29.593950",
  "prompt": "...",
  "model": "4.0",
  "resolution": "4k",
  "ratio": "3:4",
  "mode": "t2i",
  "images": [...],
  "historyId": "...",
  "duration": "25.8",
  "isNew": true  // 新增字段
}
```

## 🎨 颜色方案

### 新卡片配色
- **背景渐变**: `rgba(102, 126, 234, 0.15)` → `rgba(118, 75, 162, 0.15)`
- **边框颜色**: `rgba(102, 126, 234, 0.5)`
- **阴影颜色**: `rgba(102, 126, 234, 0.2)` → `rgba(102, 126, 234, 0.4)` (呼吸)
- **徽章渐变**: `#667eea` → `#764ba2`

### 普通卡片配色
- **背景**: `var(--bg-tertiary)` (灰色)
- **无边框**
- **无阴影**

## 🔄 状态流转

```
生成图片
   ↓
添加到历史记录 (isNew: true)
   ↓
显示紫蓝色卡片 + "新"徽章
   ↓
用户点击查看原图
   ↓
调用 API 标记为已查看
   ↓
移除 isNew 标记
   ↓
更新 UI (移除特殊样式)
   ↓
恢复普通灰色卡片
```

## 💡 用户体验优化

### 1. 即时反馈
- 生成完成后立即显示特殊样式
- 无需刷新页面

### 2. 自动标记
- 打开原图即自动标记
- 无需手动操作

### 3. 平滑过渡
- 样式变化有 0.3s 过渡动画
- 徽章移除有淡出效果

### 4. 视觉吸引
- 呼吸动画吸引注意力
- 星星旋转增加趣味性
- 徽章浮动提示新内容

## 🐛 边缘情况处理

### 1. 刷新页面
- ✅ 新标记会保留 (存储在服务器)
- ✅ 刷新后仍然显示特殊样式

### 2. 多端同步
- ✅ 一端查看后,其他端刷新会同步状态
- ✅ 标记状态存储在服务器端

### 3. 网络错误
- ✅ 标记失败不影响查看功能
- ✅ 只在控制台记录错误

### 4. 历史记录删除
- ✅ 删除记录时自动清理标记
- ✅ 不会留下孤立的标记数据

## 📝 更新日志

### v1.2 - 2025-01-XX
- ✨ 新增: 新生成照片特殊标记功能
- ✨ 新增: 查看后自动移除标记
- 🎨 优化: 添加呼吸动画和浮动效果
- 🎨 优化: 紫蓝色渐变配色方案
- 🐛 修复: 多端同步标记状态

## 🎓 设计理念

### 1. 非侵入式
- 不影响现有功能
- 不改变用户操作流程
- 只是视觉上的增强

### 2. 自动化
- 自动添加标记
- 自动移除标记
- 无需用户干预

### 3. 视觉友好
- 使用柔和的渐变色
- 动画不过于夸张
- 符合整体设计风格

### 4. 性能优先
- CSS 动画使用 GPU 加速
- 最小化 DOM 操作
- 异步标记不阻塞 UI

## 🚀 未来改进

### 计划中的功能
1. **自定义标记时长**
   - 允许用户设置标记保留时间
   - 例如: 24小时后自动移除

2. **批量标记**
   - 一键标记所有为已查看
   - 清空所有新标记

3. **标记统计**
   - 显示未查看的新照片数量
   - 在侧边栏显示徽章

4. **自定义配色**
   - 允许用户选择标记颜色
   - 提供多种配色方案

## 💬 用户反馈

如果您有任何建议或发现问题,欢迎:
1. 提交 Issue
2. 提交 Pull Request
3. 在讨论区反馈

---

**享受更清晰的照片管理体验! 🎉**

